<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æå»£æ‰è€å¸«çš„æ•¸å­¸è³‡æºç¶² | Math Lab</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #2c3e50; /* æ·±è—è‰² - å­¸è¡“æ„Ÿ */
            --accent-color: #3498db;  /* äº®è—è‰² - ç§‘æŠ€æ„Ÿ */
            --dse-color: #f1c40f;     /* é‡‘è‰² - DSE é‡é» */
            --grid-color: rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Lato', 'Noto Sans TC', sans-serif;
            background-color: #f8f9fa;
            /* æ•¸å­¸æ–¹æ ¼ç´™èƒŒæ™¯æ•ˆæœ */
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 20px 20px;
            min-height: 100vh;
        }

        /* é ‚éƒ¨å°èˆªæ¬„ */
        .navbar {
            background-color: var(--primary-color);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .navbar-brand {
            color: white !important;
            font-weight: 700;
            letter-spacing: 1px;
        }

        /* å´é‚Šç¯©é¸æ¬„ */
        .sidebar {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #eee;
        }
        .filter-group-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 15px;
            margin-bottom: 10px;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }

        /* å·¥å…·å¡ç‰‡è¨­è¨ˆ */
        .tool-card {
            background: white;
            border: none;
            border-radius: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
            height: 100%;
            position: relative;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }
        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: var(--accent-color);
        }
        .card-body {
            padding: 1.5rem;
        }
        .card-title {
            font-weight: 700;
            color: var(--primary-color);
        }
        .card-meta {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 10px;
        }
        .badge-grade {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
        }
        .badge-topic {
            background-color: #f3e5f5;
            color: #7b1fa2;
            border: 1px solid #e1bee7;
        }

        /* DSE å°ˆå±¬æ¨™è¨˜ */
        .dse-ribbon {
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--dse-color);
            color: #fff;
            padding: 5px 10px;
            font-size: 0.8rem;
            font-weight: bold;
            border-bottom-left-radius: 10px;
            box-shadow: -2px 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
        }
        .dse-icon {
            color: #fff; 
            margin-right: 3px;
        }

        /* æ•™å¸«å°ˆç”¨é–å®šé®ç½© */
        .teacher-locked {
            filter: grayscale(1);
            opacity: 0.6;
            pointer-events: none;
        }
        
        /* æ•™å­¸è£é£¾å…ƒç´  */
        .math-deco {
            position: absolute;
            opacity: 0.1;
            z-index: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fa-solid fa-square-root-variable me-2"></i>æå»£æ‰è€å¸«_æ•¸å­¸è³‡æºç¶²
            </a>
            <div class="d-flex align-items-center">
                <button id="authBtn" class="btn btn-outline-light btn-sm" onclick="toggleAuth()">
                    <i class="fa-solid fa-user-tie me-1"></i> <span id="authText">æ•™å¸«ç™»å…¥</span>
                </button>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        
        <div class="row mb-4 align-items-center">
            <div class="col-md-8">
                <h4 id="welcomeMsg" class="mb-1">æ­¡è¿ä¾†åˆ°æ•¸å­¸è³‡æºç¶² ğŸ‘‹</h4>
                <p class="text-muted small">é¸æ“‡ä¸‹æ–¹çš„ç¯©é¸æ¢ä»¶æ‰¾åˆ°é©åˆçš„å·¥å…·</p>
            </div>
            <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-text bg-white"><i class="fa-solid fa-magnifying-glass"></i></span>
                    <input type="text" id="searchInput" class="form-control" placeholder="æœå°‹å·¥å…·åç¨±..." onkeyup="renderTools()">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-3 mb-4">
                <div class="sidebar">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="m-0"><i class="fa-solid fa-filter me-2"></i>ç¯©é¸</h5>
                        <button class="btn btn-sm btn-link text-decoration-none" onclick="resetFilters()">é‡ç½®</button>
                    </div>

                    <div id="studentFilters">
                        <div class="filter-group-title">å¹´ç´š</div>
                        <div class="form-check"><input class="form-check-input filter-grade" type="checkbox" value="S1" onchange="renderTools()"> <label class="form-check-label">ä¸­ä¸€ç´š</label></div>
                        <div class="form-check"><input class="form-check-input filter-grade" type="checkbox" value="S2" onchange="renderTools()"> <label class="form-check-label">ä¸­äºŒç´š</label></div>
                        <div class="form-check"><input class="form-check-input filter-grade" type="checkbox" value="S3" onchange="renderTools()"> <label class="form-check-label">ä¸­ä¸‰ç´š</label></div>
                        <div class="form-check"><input class="form-check-input filter-grade" type="checkbox" value="S4" onchange="renderTools()"> <label class="form-check-label">ä¸­å››ç´š</label></div>
                        <div class="form-check"><input class="form-check-input filter-grade" type="checkbox" value="S5" onchange="renderTools()"> <label class="form-check-label">ä¸­äº”ç´š</label></div>
                        <div class="form-check"><input class="form-check-input filter-grade" type="checkbox" value="S6" onchange="renderTools()"> <label class="form-check-label">ä¸­å…­ç´š</label></div>
                        <div class="form-check"><input class="form-check-input filter-grade" type="checkbox" value="ä¸é™å¹´ç´š" onchange="renderTools()"> <label class="form-check-label">ä¸é™</label></div>
                        

                        <div class="filter-group-title">èª²é¡Œ</div>
                        <select id="topicFilter" class="form-select form-select-sm" onchange="renderTools()">
                            <option value="">æ‰€æœ‰èª²é¡Œ</option>
                            <option value="ä»£æ•¸">ä»£æ•¸ (Algebra)</option>
                            <option value="å¹¾ä½•">å¹¾ä½• (Geometry)</option>
                            <option value="çµ±è¨ˆ">çµ±è¨ˆ (Statistics)</option>
                            <option value="æ¦‚ç‡">æ¦‚ç‡ (Probability)</option>
                            <option value="å…¶ä»–å…§å®¹">å…¶ä»–å…§å®¹ (others)</option>
                        </select>

                        <div class="filter-group-title">ç‰¹æ®Šæ¨™ç±¤</div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="dseFilter" onchange="renderTools()">
                            <label class="form-check-label text-warning fw-bold" for="dseFilter"><i class="fa-solid fa-star me-1"></i>åªé¡¯ç¤º DSE é©ç”¨</label>
                        </div>
                    </div>

                    <div id="teacherFilters" style="display: none;">
                        <div class="filter-group-title text-danger">æ•™å¸«å°ˆç”¨é¡åˆ¥</div>
                        <div class="form-check"><input class="form-check-input filter-type" type="checkbox" value="admin" onchange="renderTools()"> <label class="form-check-label">è¡Œæ”¿å·¥å…·</label></div>
                        <div class="form-check"><input class="form-check-input filter-type" type="checkbox" value="analysis" onchange="renderTools()"> <label class="form-check-label">æ•¸æ“šåˆ†æ</label></div>
                        <div class="form-check"><input class="form-check-input filter-type" type="checkbox" value="interactive" onchange="renderTools()"> <label class="form-check-label">èª²å®¤äº’å‹•</label></div>
                        <div class="form-check"><input class="form-check-input filter-type" type="checkbox" value="generator" onchange="renderTools()"> <label class="form-check-label">å·¥ä½œç´™ç”Ÿæˆ</label></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-9">
                <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4" id="toolsContainer">
                    </div>
            </div>
        </div>
    </div>

    <script>
        // ---------------------------------------------------------
        // 1. è³‡æ–™åº« (æ‚¨å¯ä»¥éš¨æ™‚æ–°å¢å·¥å…·æ–¼æ­¤)
        // ---------------------------------------------------------
        const toolsData = [
            // --- å­¸ç”ŸåŠé€šç”¨å·¥å…· ---
                    {
                        id: 1,  // éš¨ä¾¿çµ¦å€‹ç·¨è™Ÿ
                        title: "æŒ‡æ•¸å®šå¾‹_æ–‡æ†‘è€ƒè©¦é¡Œå‹",  // å·¥å…·åç¨±
                        desc: "é‡å°HKDSEå·ä¸€æŒ‡æ•¸å®šå¾‹é¡Œå‹çš„æ¸¬é©—ã€‚", // ç°¡ä»‹
                        audience: ["student", "teacher"], // ç›®æ¨™ç”¨æˆ¶: "student", "teacher", æˆ–å…©è€…éƒ½æœ‰
                        grades: ["S3", "S4", "S5", "S6"],        // å¹´ç´š
                        topic: "ä»£æ•¸",         // èª²é¡Œ
                        isDSE: true,          // æ˜¯å¦ DSE é©ç”¨
                        updateDate: "2026-01-29", // æ—¥æœŸ
                        url: "./tools/æŒ‡æ•¸å®šå¾‹_æ–‡æ†‘è€ƒè©¦é¡Œå‹/index.html" // å°æ‡‰çš„è·¯å¾‘ (é‡è¦ï¼)
                }, 
                    {
                        id: 2,  // éš¨ä¾¿çµ¦å€‹ç·¨è™Ÿ
                        title: "å› å¼åˆ†è§£_æ–‡æ†‘è€ƒè©¦é¡Œå‹",  // å·¥å…·åç¨±
                        desc: "é‡å°HKDSEå·ä¸€å› å¼åˆ†è§£é¡Œå‹çš„æ¸¬é©—ã€‚", // ç°¡ä»‹
                        audience: ["student", "teacher"], // ç›®æ¨™ç”¨æˆ¶: "student", "teacher", æˆ–å…©è€…éƒ½æœ‰
                        grades: ["S3", "S4", "S5", "S6"],        // å¹´ç´š
                        topic: "ä»£æ•¸",         // èª²é¡Œ
                        isDSE: true,          // æ˜¯å¦ DSE é©ç”¨
                        updateDate: "2026-01-29", // æ—¥æœŸ
                        url: "./tools/å› å¼åˆ†è§£_æ–‡æ†‘è€ƒè©¦é¡Œå‹/index.html" // å°æ‡‰çš„è·¯å¾‘ (é‡è¦ï¼)
                },
                    {
                        id: 3,  // éš¨ä¾¿çµ¦å€‹ç·¨è™Ÿ
                        title: "åæ‡‰åŠ›æ¸¬è©¦_å¹³å‡æ•¸åŠä¸­ä½æ•¸è¨ˆç®—",  // å·¥å…·åç¨±
                        desc: "è¨˜éŒ„åæ‡‰ç‡ˆæ´»å‹•ä¸­çš„åæ‡‰æ™‚é–“ï¼Œä¸¦è¨ˆç®—å‡ºåæ‡‰æ™‚é–“çš„å¹³å‡æ•¸åŠä¸­ä½æ•¸ã€‚", // ç°¡ä»‹
                        audience: ["student", "teacher"], // ç›®æ¨™ç”¨æˆ¶: "student", "teacher", æˆ–å…©è€…éƒ½æœ‰
                        grades: ["S3"],        // å¹´ç´š
                        topic: "çµ±è¨ˆ",         // èª²é¡Œ
                        isDSE: false,          // æ˜¯å¦ DSE é©ç”¨
                        updateDate: "2026-01-29", // æ—¥æœŸ
                        url: "./tools/åæ‡‰åŠ›æ¸¬è©¦_å¹³å‡æ•¸åŠä¸­ä½æ•¸è¨ˆç®—/index.html" // å°æ‡‰çš„è·¯å¾‘ (é‡è¦ï¼)
                },
                    {
                        id: 4,  // éš¨ä¾¿çµ¦å€‹ç·¨è™Ÿ
                        title: "ç™¾åˆ†æ³•_ç›ˆè™§åŠæŠ˜æ‰£å•é¡Œ",  // å·¥å…·åç¨±
                        desc: "é‡å°ä¸­ä¸€ç´šç™¾åˆ†æ³•ç•¶ä¸­ç›ˆè™§åŠæŠ˜æ‰£çš„æ¸¬é©—(åˆ†ç‚ºä¸‰å€‹é›£åº¦)", // ç°¡ä»‹
                        audience: ["student", "teacher"], // ç›®æ¨™ç”¨æˆ¶: "student", "teacher", æˆ–å…©è€…éƒ½æœ‰
                        grades: ["S1"],        // å¹´ç´š
                        topic: "ä»£æ•¸",         // èª²é¡Œ
                        isDSE: false,          // æ˜¯å¦ DSE é©ç”¨
                        updateDate: "2026-01-29", // æ—¥æœŸ
                        url: "./tools/ç™¾åˆ†æ³•ï¼ˆä¸€ï¼‰_ç›ˆè™§åŠæŠ˜æ‰£å•é¡Œ/index.html" // å°æ‡‰çš„è·¯å¾‘ (é‡è¦ï¼)
                },
                    {
                        id: 5,  // éš¨ä¾¿çµ¦å€‹ç·¨è™Ÿ
                        title: "è·¯å¾‘é€£æ¥è§£è¬æŒ‘æˆ°",  // å·¥å…·åç¨±
                        desc: "è§£è¬æŒ‘æˆ° - è·¯å¾‘é€£æ¥", // ç°¡ä»‹
                        audience: ["student", "teacher"], // ç›®æ¨™ç”¨æˆ¶: "student", "teacher", æˆ–å…©è€…éƒ½æœ‰
                        grades: ["ä¸é™å¹´ç´š"],        // å¹´ç´š
                        topic: "ä»£æ•¸",         // èª²é¡Œ
                        isDSE: false,          // æ˜¯å¦ DSE é©ç”¨
                        updateDate: "2026-01-29", // æ—¥æœŸ
                        url: "./tools/è·¯å¾‘é€£æ¥è§£è¬æŒ‘æˆ°/index.html" // å°æ‡‰çš„è·¯å¾‘ (é‡è¦ï¼)
                },                
                    // å¦‚æœæœ‰ç¬¬äºŒå€‹å·¥å…·ï¼Œå°±åœ¨é€™è£¡åŠ é€—è™Ÿï¼Œç„¶å¾Œè¤‡è£½ä¸Šé¢çš„ { ... } å†è²¼ä¸Šä¸€ä»½
            // --- æ•™å¸«å°ˆç”¨å·¥å…· ---

        ];

        // ---------------------------------------------------------
        // 2. ç‹€æ…‹ç®¡ç†
        // ---------------------------------------------------------
        let isTeacherMode = false; // é è¨­ç‚ºå­¸ç”Ÿæ¨¡å¼

        // ---------------------------------------------------------
        // 3. æ ¸å¿ƒåŠŸèƒ½ï¼šæ¸²æŸ“å·¥å…·å¡ç‰‡
        // ---------------------------------------------------------
        function renderTools() {
            const container = document.getElementById('toolsContainer');
            const searchVal = document.getElementById('searchInput').value.toLowerCase();
            
            // å–å¾—å‹¾é¸çš„å¹´ç´š
            const checkedGrades = Array.from(document.querySelectorAll('.filter-grade:checked')).map(cb => cb.value);
            // å–å¾—é¸ä¸­çš„èª²é¡Œ
            const selectedTopic = document.getElementById('topicFilter').value;
            // å–å¾— DSE é–‹é—œ
            const isDSEOnly = document.getElementById('dseFilter').checked;
            // å–å¾—å‹¾é¸çš„æ•™å¸«é¡åˆ¥
            const checkedTypes = Array.from(document.querySelectorAll('.filter-type:checked')).map(cb => cb.value);

            container.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨

            // éæ¿¾é‚è¼¯
            const filtered = toolsData.filter(tool => {
                // A. æœå°‹é—œéµå­—éæ¿¾
                if (!tool.title.toLowerCase().includes(searchVal) && !tool.desc.toLowerCase().includes(searchVal)) return false;

                // B. æ¬Šé™éæ¿¾ (é‡é»)
                // å¦‚æœæ˜¯å­¸ç”Ÿæ¨¡å¼ï¼Œéš±è—åªæœ‰ "teacher" çš„å·¥å…·
                if (!isTeacherMode && tool.audience.length === 1 && tool.audience[0] === 'teacher') return false;

                // C. æ¨™ç±¤éæ¿¾ (åƒ…å°å­¸ç”Ÿå·¥å…·ç”Ÿæ•ˆï¼Œé™¤éæ˜¯æ•™å¸«æ¨¡å¼ä¸‹æŸ¥çœ‹å­¸ç”Ÿå·¥å…·)
                if (tool.audience.includes('student')) {
                    if (checkedGrades.length > 0) {
                        // æª¢æŸ¥è©²å·¥å…·çš„é©ç”¨å¹´ç´šæ˜¯å¦æœ‰ä»»ä½•ä¸€å€‹åœ¨å‹¾é¸åå–®ä¸­
                        const hasMatch = tool.grades.some(g => checkedGrades.includes(g));
                        if (!hasMatch) return false;
                    }
                    if (selectedTopic && tool.topic !== selectedTopic) return false;
                    if (isDSEOnly && !tool.isDSE) return false;
                }

                // D. æ•™å¸«é¡åˆ¥éæ¿¾ (åƒ…åœ¨æ•™å¸«æ¨¡å¼ä¸‹ç”Ÿæ•ˆ)
                if (isTeacherMode && tool.audience.includes('teacher') && !tool.audience.includes('student')) {
                     if (checkedTypes.length > 0 && !checkedTypes.includes(tool.category)) return false;
                }

                return true;
            });

            // ç”Ÿæˆ HTML
            if (filtered.length === 0) {
                container.innerHTML = `<div class="col-12 text-center text-muted py-5">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„å·¥å…· <i class="fa-regular fa-face-frown"></i></div>`;
                return;
            }

            filtered.forEach(tool => {
                // åˆ¤æ–·æ˜¯å¦ç‚ºæ•™å¸«å°ˆç”¨
                const isTeacherTool = tool.audience.length === 1 && tool.audience[0] === 'teacher';
                
                // æ¨™ç±¤é¡¯ç¤ºé‚è¼¯
                let tagsHtml = '';
                if (tool.grades) {
                    tool.grades.forEach(g => tagsHtml += `<span class="badge badge-grade me-1">${g}</span>`);
                }
                if (tool.topic) {
                    tagsHtml += `<span class="badge badge-topic me-1">${tool.topic}</span>`;
                }
                if (isTeacherTool) {
                    tagsHtml += `<span class="badge bg-danger me-1"><i class="fa-solid fa-lock me-1"></i>æ•™å¸«å°ˆç”¨</span>`;
                    tagsHtml += `<span class="badge bg-secondary me-1">${tool.category || 'ä¸€èˆ¬'}</span>`;
                }

                // DSE æ¨™ç±¤ HTML
                const dseBadge = tool.isDSE ? 
                    `<div class="dse-ribbon"><i class="fa-solid fa-star dse-icon"></i>DSE é©ç”¨</div>` : '';

                // å¡ç‰‡ HTML
                const cardHtml = `
                    <div class="col">
                        <div class="card tool-card h-100">
                            ${dseBadge}
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${tool.title}</h5>
                                <div class="mb-2">
                                    ${tagsHtml}
                                </div>
                                <p class="card-text text-secondary flex-grow-1 small">${tool.desc}</p>
                                <div class="mt-3 pt-3 border-top d-flex justify-content-between align-items-center">
                                    <small class="text-muted"><i class="fa-regular fa-calendar me-1"></i>${tool.updateDate}</small>
                                    <a href="${tool.url}" class="btn btn-sm btn-${isTeacherTool ? 'danger' : 'primary'}">
                                        é–‹å•Ÿå·¥å…· <i class="fa-solid fa-arrow-right ms-1"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += cardHtml;
            });
        }

        // ---------------------------------------------------------
        // 4. æ¨¡æ“¬ç™»å…¥ç³»çµ± (æœªä¾†é€™è£¡é€£æ¥ Firebase)
        // ---------------------------------------------------------
        function toggleAuth() {
            // åˆ‡æ›ç‹€æ…‹
            isTeacherMode = !isTeacherMode;
            
            const btn = document.getElementById('authBtn');
            const authText = document.getElementById('authText');
            const welcomeMsg = document.getElementById('welcomeMsg');
            const teacherFilters = document.getElementById('teacherFilters');
            const studentFilters = document.getElementById('studentFilters');

            if (isTeacherMode) {
                // ç™»å…¥å¾Œç‹€æ…‹
                btn.classList.replace('btn-outline-light', 'btn-warning');
                btn.innerHTML = `<i class="fa-solid fa-right-from-bracket me-1"></i> ç™»å‡º`;
                welcomeMsg.innerHTML = `æ­¡è¿å›ä¾†ï¼Œé™³è€å¸« <span class="badge bg-warning text-dark">æ•™å¸«æ¨¡å¼</span>`;
                teacherFilters.style.display = 'block';
                // studentFilters.style.opacity = '0.5'; // è®“å­¸ç”Ÿç¯©é¸è®Šæ·¡ï¼Œæˆ–ä¿æŒåŸæ¨£
            } else {
                // ç™»å‡ºå¾Œç‹€æ…‹
                btn.classList.replace('btn-warning', 'btn-outline-light');
                btn.innerHTML = `<i class="fa-solid fa-user-tie me-1"></i> æ•™å¸«ç™»å…¥`;
                welcomeMsg.innerHTML = `æ­¡è¿ä¾†åˆ°æ•¸å­¸è³‡æºåº« ğŸ‘‹`;
                teacherFilters.style.display = 'none';
                studentFilters.style.opacity = '1';
            }

            // é‡æ–°æ¸²æŸ“åˆ—è¡¨
            renderTools();
        }

        function resetFilters() {
            document.querySelectorAll('input[type=checkbox]').forEach(el => el.checked = false);
            document.getElementById('searchInput').value = '';
            document.getElementById('topicFilter').value = '';
            renderTools();
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderTools();
        });

    </script>
</body>
</html>
