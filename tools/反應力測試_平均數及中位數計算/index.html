<!doctype html>
<html lang="zh-TW">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åæ‡‰åŠ›æ¸¬è©¦</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";
      import { getDatabase, ref, push, onValue, query, orderByChild, limitToFirst } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyDGuKqva8tVzjVgPnPgVjPmX064okR7NRI",
        authDomain: "project1-998f6.firebaseapp.com",
        databaseURL: "https://project1-998f6-default-rtdb.firebaseio.com",
        projectId: "project1-998f6",
        storageBucket: "project1-998f6.firebasestorage.app",
        messagingSenderId: "31375712023",
        appId: "1:31375712023:web:7cd9afe8ce1ab753aa6152",
        measurementId: "G-6KJMNCDZ3C"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const database = getDatabase(app);
      
      // Make Firebase available globally
      window.firebaseApp = app;
      window.firebaseDatabase = database;
      window.firebaseRef = ref;
      window.firebasePush = push;
      window.firebaseOnValue = onValue;
      window.firebaseQuery = query;
      window.firebaseOrderByChild = orderByChild;
      window.firebaseLimitToFirst = limitToFirst;
    </script>
  <style>
        .bulb {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 4px solid #374151;
        }
        .bulb-off {
            background: linear-gradient(145deg, #6b7280, #4b5563);
            box-shadow: inset 5px 5px 10px #374151, inset -5px -5px 10px #9ca3af;
        }
        .bulb-on {
            background: linear-gradient(145deg, #fbbf24, #f59e0b);
            box-shadow: 0 0 30px #fbbf24, inset 2px 2px 5px #f59e0b, inset -2px -2px 5px #fcd34d;
            border-color: #f59e0b;
        }
        .countdown {
            font-size: 8rem;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 min-h-screen flex flex-col items-center justify-center text-white font-sans">
  <div class="container mx-auto px-4 text-center">
   <h1 class="text-4xl font-bold mb-8 text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500">âš¡ åæ‡‰åŠ›æ¸¬è©¦ âš¡</h1><!-- ç”¨æˆ¶èº«ä»½é¸æ“‡ -->
   <div id="userSetup" class="mb-8 bg-white/10 backdrop-blur-sm rounded-lg p-6 max-w-md mx-auto">
    <h3 class="text-2xl font-bold mb-4 text-yellow-400">ğŸ‘¤ è«‹é¸æ“‡æ‚¨çš„èº«ä»½</h3>
    <div class="mb-4"><label class="flex items-center mb-2 cursor-pointer"> <input type="radio" name="userType" value="teacher" class="mr-3 w-4 h-4"> <span class="text-lg">ğŸ‘¨â€ğŸ« è€å¸«</span> </label> <label class="flex items-center mb-2 cursor-pointer"> <input type="radio" name="userType" value="student" class="mr-3 w-4 h-4"> <span class="text-lg">ğŸ‘¨â€ğŸ“ å­¸ç”Ÿ</span> </label> <label class="flex items-center cursor-pointer"> <input type="radio" name="userType" value="guest" class="mr-3 w-4 h-4"> <span class="text-lg">ğŸ‘¤ è¨ªå®¢</span> </label>
    </div><!-- è€å¸«è³‡æ–™è¼¸å…¥ -->
    <div id="teacherForm" class="hidden mb-4 space-y-3"><input type="text" id="teacherName" placeholder="è«‹è¼¸å…¥å…¨å" class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-yellow-400 focus:outline-none"> <input type="password" id="teacherPassword" placeholder="è«‹è¼¸å…¥æ•™å¸«å¯†ç¢¼" class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-yellow-400 focus:outline-none">
    </div><!-- å­¸ç”Ÿè³‡æ–™è¼¸å…¥ -->
    <div id="studentForm" class="hidden mb-4 space-y-3"><select id="studentClass" class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30 focus:border-yellow-400 focus:outline-none"> <option value="" style="background-color: #1f2937; color: #9ca3af;">è«‹é¸æ“‡ç­åˆ¥</option> <option value="1A" style="background-color: #1f2937; color: #ffffff;">1A</option> <option value="1B" style="background-color: #1f2937; color: #ffffff;">1B</option> <option value="1C" style="background-color: #1f2937; color: #ffffff;">1C</option> <option value="1D" style="background-color: #1f2937; color: #ffffff;">1D</option> <option value="2A" style="background-color: #1f2937; color: #ffffff;">2A</option> <option value="2B" style="background-color: #1f2937; color: #ffffff;">2B</option> <option value="2C" style="background-color: #1f2937; color: #ffffff;">2C</option> <option value="2D" style="background-color: #1f2937; color: #ffffff;">2D</option> <option value="3A" style="background-color: #1f2937; color: #ffffff;">3A</option> <option value="3B" style="background-color: #1f2937; color: #ffffff;">3B</option> <option value="3C" style="background-color: #1f2937; color: #ffffff;">3C</option> <option value="3D" style="background-color: #1f2937; color: #ffffff;">3D</option> <option value="4A" style="background-color: #1f2937; color: #ffffff;">4A</option> <option value="4B" style="background-color: #1f2937; color: #ffffff;">4B</option> <option value="4C" style="background-color: #1f2937; color: #ffffff;">4C</option> <option value="4D" style="background-color: #1f2937; color: #ffffff;">4D</option> <option value="5A" style="background-color: #1f2937; color: #ffffff;">5A</option> <option value="5B" style="background-color: #1f2937; color: #ffffff;">5B</option> <option value="5C" style="background-color: #1f2937; color: #ffffff;">5C</option> <option value="5D" style="background-color: #1f2937; color: #ffffff;">5D</option> <option value="6A" style="background-color: #1f2937; color: #ffffff;">6A</option> <option value="6B" style="background-color: #1f2937; color: #ffffff;">6B</option> <option value="6C" style="background-color: #1f2937; color: #ffffff;">6C</option> <option value="6D" style="background-color: #1f2937; color: #ffffff;">6D</option> </select> <input type="number" id="studentNumber" placeholder="è«‹è¼¸å…¥å­¸è™Ÿ (1-40)" min="1" max="40" class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-yellow-400 focus:outline-none">
    </div><button id="confirmUserBtn" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 px-6 py-3 rounded-lg text-lg font-bold shadow-lg transform hover:scale-105 transition-all duration-200 mb-3"> âœ… ç¢ºèª </button> <button id="homeLeaderboardBtn" class="w-full bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 px-6 py-3 rounded-lg text-lg font-bold shadow-lg transform hover:scale-105 transition-all duration-200"> ğŸ† æŸ¥çœ‹æ’è¡Œæ¦œ </button>
   </div><!-- éŠæˆ²ç‹€æ…‹é¡¯ç¤º -->
   <div id="gameStatus" class="mb-8 hidden">
    <div id="instructions" class="text-lg mb-6 bg-white/10 backdrop-blur-sm rounded-lg p-6">
     <p class="mb-4">ğŸ¯ æ¸¬è©¦æ‚¨çš„åæ‡‰é€Ÿåº¦ï¼</p>
     <p class="mb-2">â€¢ æŒ‰ä¸‹é–‹å§‹å¾Œå€’æ•¸3ç§’</p>
     <p class="mb-2">â€¢ ç‡ˆæ³¡äº®èµ·æ™‚ç«‹å³é»æ“Š</p>
     <p class="mb-2">â€¢ å®Œæˆ20æ¬¡æ¸¬è©¦</p>
     <p>â€¢ æŸ¥çœ‹æ‚¨çš„å¹³å‡åæ‡‰æ™‚é–“</p>
    </div>
    <div id="countdown" class="countdown text-yellow-400 hidden"></div>
    <div id="progress" class="hidden mb-6">
     <div class="text-xl mb-2">
      é€²åº¦: <span id="currentCount">0</span>/20
     </div>
     <div class="w-full bg-gray-700 rounded-full h-3">
      <div id="progressBar" class="bg-gradient-to-r from-green-400 to-blue-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
     </div>
    </div>
   </div><!-- ç‡ˆæ³¡å€åŸŸ -->
   <div id="bulbContainer" class="relative w-full h-96 mb-8 max-w-4xl mx-auto">
    <div class="bulb bulb-off absolute top-0 left-0" data-bulb="0"></div>
    <div class="bulb bulb-off absolute top-0 left-1/2 transform -translate-x-1/2" data-bulb="1"></div>
    <div class="bulb bulb-off absolute top-0 right-0" data-bulb="2"></div>
    <div class="bulb bulb-off absolute bottom-0 left-0" data-bulb="3"></div>
    <div class="bulb bulb-off absolute bottom-0 left-1/2 transform -translate-x-1/2" data-bulb="4"></div>
    <div class="bulb bulb-off absolute bottom-0 right-0" data-bulb="5"></div>
   </div><!-- æ§åˆ¶æŒ‰éˆ• -->
   <div class="mb-8"><button id="startBtn" class="bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700 px-8 py-4 rounded-full text-xl font-bold shadow-lg transform hover:scale-105 transition-all duration-200 hidden"> ğŸš€ é–‹å§‹æ¸¬è©¦ </button> <button id="showTimesBtn" class="bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700 px-6 py-3 rounded-full text-lg font-bold shadow-lg transform hover:scale-105 transition-all duration-200 hidden ml-2"> ğŸ“Š é¡¯ç¤ºåæ‡‰æ™‚é–“ </button> <button id="sortTimesBtn" class="bg-gradient-to-r from-teal-500 to-green-600 hover:from-teal-600 hover:to-green-700 px-6 py-3 rounded-full text-lg font-bold shadow-lg transform hover:scale-105 transition-all duration-200 hidden ml-2"> ğŸ”¢ æ’åºæ•¸æ“š </button> <button id="showMedianBtn" class="bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 px-6 py-3 rounded-full text-lg font-bold shadow-lg transform hover:scale-105 transition-all duration-200 hidden ml-2"> ğŸ“ˆ é¡¯ç¤ºä¸­ä½æ•¸ </button> <button id="showAverageBtn" class="bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 px-6 py-3 rounded-full text-lg font-bold shadow-lg transform hover:scale-105 transition-all duration-200 hidden ml-2"> ğŸ“Š é¡¯ç¤ºå¹³å‡æ•¸ </button> <button id="leaderboardBtn" class="bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 px-6 py-3 rounded-full text-lg font-bold shadow-lg transform hover:scale-105 transition-all duration-200 hidden ml-2"> ğŸ† æ’è¡Œæ¦œ </button> <button id="resetBtn" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 px-6 py-3 rounded-full text-lg font-bold shadow-lg transform hover:scale-105 transition-all duration-200 hidden ml-2"> ğŸ”„ é‡æ–°é–‹å§‹ </button>
   </div><!-- çµæœé¡¯ç¤º -->
   <div id="results" class="hidden bg-white/10 backdrop-blur-sm rounded-lg p-6 max-w-2xl mx-auto">
    <h3 class="text-2xl font-bold mb-4 text-yellow-400">ğŸ“ˆ æ¸¬è©¦çµæœ</h3>
    <div id="reactionTimes" class="mb-6 hidden">
     <h4 class="text-lg font-semibold mb-3">å„æ¬¡åæ‡‰æ™‚é–“ (ç§’):</h4>
     <div id="timesList" class="grid grid-cols-5 gap-2 text-sm"></div>
    </div>
    <div id="medianResult" class="mb-4 hidden">
     <h4 class="text-lg font-semibold mb-3">ä¸­ä½æ•¸è¨ˆç®—:</h4>
     <div id="medianCalculation" class="bg-black/20 rounded p-4 font-mono text-sm"></div>
     <div id="medianValue" class="text-2xl font-bold text-green-400 mt-4"></div>
    </div>
    <div id="averageResult" class="mb-4 hidden">
     <h4 class="text-lg font-semibold mb-3">å¹³å‡æ•¸è¨ˆç®—:</h4>
     <div id="averageCalculation" class="bg-black/20 rounded p-4 font-mono text-sm"></div>
     <div id="averageValue" class="text-2xl font-bold text-orange-400 mt-4"></div>
    </div><!-- å­¸ç”Ÿè¨ˆç®—é©—è­‰ -->
    <div id="studentCalculation" class="mb-4 hidden">
     <h4 class="text-lg font-semibold mb-3">ğŸ“ è«‹è¨ˆç®—æ‚¨çš„åæ‡‰æ™‚é–“çµ±è¨ˆæ•¸æ“š</h4>
     <div class="bg-yellow-500/20 rounded p-4 mb-4">
      <p class="text-sm mb-2">âš ï¸ å­¸ç”Ÿéœ€è¦è‡ªè¡Œè¨ˆç®—å¹³å‡æ•¸å’Œä¸­ä½æ•¸æ‰èƒ½å„²å­˜æˆç¸¾</p>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <div><label class="block text-sm font-medium mb-2">æ‚¨è¨ˆç®—çš„å¹³å‡æ•¸ (ç§’):</label> <input type="number" id="studentAverage" step="0.001" placeholder="0.000" class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-yellow-400 focus:outline-none">
      </div>
      <div><label class="block text-sm font-medium mb-2">æ‚¨è¨ˆç®—çš„ä¸­ä½æ•¸ (ç§’):</label> <input type="number" id="studentMedian" step="0.001" placeholder="0.000" class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:border-yellow-400 focus:outline-none">
      </div>
     </div><button id="submitCalculationBtn" class="w-full bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700 px-6 py-3 rounded-lg text-lg font-bold shadow-lg transform hover:scale-105 transition-all duration-200"> âœ… æäº¤è¨ˆç®—çµæœ </button>
     <div id="calculationFeedback" class="mt-4 hidden"></div>
    </div>
   </div><!-- æ’è¡Œæ¦œ -->
   <div id="leaderboard" class="hidden bg-white/10 backdrop-blur-sm rounded-lg p-6 max-w-4xl mx-auto">
    <h3 class="text-2xl font-bold mb-4 text-yellow-400">ğŸ† åæ‡‰åŠ›æ’è¡Œæ¦œ</h3>
    <div class="mb-4 flex flex-wrap gap-2 justify-center"><button id="showAllBtn" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg text-sm font-bold transition-all duration-200"> ğŸ‘¥ æ‰€æœ‰ç”¨æˆ¶ </button> <button id="showStudentsBtn" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg text-sm font-bold transition-all duration-200"> ğŸ‘¨â€ğŸ“ å­¸ç”Ÿ </button> <button id="showTeachersBtn" class="bg-purple-500 hover:bg-purple-600 px-4 py-2 rounded-lg text-sm font-bold transition-all duration-200"> ğŸ‘¨â€ğŸ« è€å¸« </button> <button id="closeLeaderboardBtn" class="bg-gray-500 hover:bg-gray-600 px-4 py-2 rounded-lg text-sm font-bold transition-all duration-200"> âŒ é—œé–‰ </button>
    </div>
    <div id="leaderboardContent" class="bg-black/20 rounded-lg p-4">
     <div id="leaderboardList" class="space-y-2"></div>
    </div>
   </div>
  </div>
  <script>
        class ReactionTest {
            constructor() {
                this.reactionTimes = [];
                this.currentCount = 0;
                this.totalTests = 20;
                this.gameStarted = false;
                this.waitingForClick = false;
                this.currentLitBulb = -1;
                this.startTime = 0;
                this.userType = null;
                this.userData = {};
                this.calculatedAverage = 0;
                this.calculatedMedian = 0;
                
                this.initializeElements();
                this.bindEvents();
            }
            
            initializeElements() {
                // ç”¨æˆ¶è¨­ç½®ç›¸é—œ
                this.userSetup = document.getElementById('userSetup');
                this.confirmUserBtn = document.getElementById('confirmUserBtn');
                this.homeLeaderboardBtn = document.getElementById('homeLeaderboardBtn');
                this.teacherForm = document.getElementById('teacherForm');
                this.studentForm = document.getElementById('studentForm');
                this.teacherName = document.getElementById('teacherName');
                this.teacherPassword = document.getElementById('teacherPassword');
                this.studentClass = document.getElementById('studentClass');
                this.studentNumber = document.getElementById('studentNumber');
                
                // éŠæˆ²ç›¸é—œ
                this.gameStatus = document.getElementById('gameStatus');
                this.startBtn = document.getElementById('startBtn');
                this.showTimesBtn = document.getElementById('showTimesBtn');
                this.sortTimesBtn = document.getElementById('sortTimesBtn');
                this.showMedianBtn = document.getElementById('showMedianBtn');
                this.showAverageBtn = document.getElementById('showAverageBtn');
                this.leaderboardBtn = document.getElementById('leaderboardBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.countdown = document.getElementById('countdown');
                this.progress = document.getElementById('progress');
                this.currentCountEl = document.getElementById('currentCount');
                this.progressBar = document.getElementById('progressBar');
                this.bulbs = document.querySelectorAll('.bulb');
                this.results = document.getElementById('results');
                this.instructions = document.getElementById('instructions');
                this.reactionTimesDiv = document.getElementById('reactionTimes');
                this.medianResultDiv = document.getElementById('medianResult');
                this.averageResultDiv = document.getElementById('averageResult');
                
                // å­¸ç”Ÿè¨ˆç®—é©—è­‰
                this.studentCalculation = document.getElementById('studentCalculation');
                this.studentAverage = document.getElementById('studentAverage');
                this.studentMedian = document.getElementById('studentMedian');
                this.submitCalculationBtn = document.getElementById('submitCalculationBtn');
                this.calculationFeedback = document.getElementById('calculationFeedback');
                
                // æ’è¡Œæ¦œ
                this.leaderboard = document.getElementById('leaderboard');
                this.showAllBtn = document.getElementById('showAllBtn');
                this.showStudentsBtn = document.getElementById('showStudentsBtn');
                this.showTeachersBtn = document.getElementById('showTeachersBtn');
                this.closeLeaderboardBtn = document.getElementById('closeLeaderboardBtn');
                this.leaderboardList = document.getElementById('leaderboardList');
            }
            
            bindEvents() {
                // ç”¨æˆ¶è¨­ç½®äº‹ä»¶
                document.querySelectorAll('input[name="userType"]').forEach(radio => {
                    radio.addEventListener('change', (e) => this.handleUserTypeChange(e));
                });
                this.confirmUserBtn.addEventListener('click', () => this.confirmUser());
                this.homeLeaderboardBtn.addEventListener('click', () => this.showLeaderboard());
                
                // éŠæˆ²äº‹ä»¶
                this.startBtn.addEventListener('click', () => this.startGame());
                this.showTimesBtn.addEventListener('click', () => this.showReactionTimes());
                this.sortTimesBtn.addEventListener('click', () => this.sortReactionTimes());
                this.showMedianBtn.addEventListener('click', () => this.showMedian());
                this.showAverageBtn.addEventListener('click', () => this.showAverage());
                this.leaderboardBtn.addEventListener('click', () => this.showLeaderboard());
                this.resetBtn.addEventListener('click', () => this.resetGame());
                
                // å­¸ç”Ÿè¨ˆç®—é©—è­‰
                this.submitCalculationBtn.addEventListener('click', () => this.submitCalculation());
                
                // æ’è¡Œæ¦œäº‹ä»¶
                this.showAllBtn.addEventListener('click', () => this.loadLeaderboard('all'));
                this.showStudentsBtn.addEventListener('click', () => this.loadLeaderboard('student'));
                this.showTeachersBtn.addEventListener('click', () => this.loadLeaderboard('teacher'));
                this.closeLeaderboardBtn.addEventListener('click', () => this.hideLeaderboard());
                
                this.bulbs.forEach(bulb => {
                    bulb.addEventListener('click', (e) => this.handleBulbClick(e));
                });
            }
            
            handleUserTypeChange(e) {
                const userType = e.target.value;
                this.teacherForm.classList.add('hidden');
                this.studentForm.classList.add('hidden');
                
                if (userType === 'teacher') {
                    this.teacherForm.classList.remove('hidden');
                } else if (userType === 'student') {
                    this.studentForm.classList.remove('hidden');
                }
            }
            
            confirmUser() {
                const selectedType = document.querySelector('input[name="userType"]:checked');
                if (!selectedType) {
                    alert('è«‹é¸æ“‡æ‚¨çš„èº«ä»½ï¼');
                    return;
                }
                
                this.userType = selectedType.value;
                
                if (this.userType === 'teacher') {
                    const name = this.teacherName.value.trim();
                    const password = this.teacherPassword.value.trim();
                    
                    if (!name) {
                        alert('è«‹è¼¸å…¥æ‚¨çš„å…¨åï¼');
                        return;
                    }
                    
                    if (password !== '23879988') {
                        alert('æ•™å¸«å¯†ç¢¼éŒ¯èª¤ï¼');
                        return;
                    }
                    
                    this.userData = {
                        type: 'teacher',
                        name: name
                    };
                } else if (this.userType === 'student') {
                    const className = this.studentClass.value;
                    const number = parseInt(this.studentNumber.value);
                    
                    if (!className) {
                        alert('è«‹é¸æ“‡ç­åˆ¥ï¼');
                        return;
                    }
                    
                    if (!number || number < 1 || number > 40) {
                        alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„å­¸è™Ÿ (1-40)ï¼');
                        return;
                    }
                    
                    this.userData = {
                        type: 'student',
                        class: className,
                        number: number
                    };
                } else if (this.userType === 'guest') {
                    this.userData = {
                        type: 'guest'
                    };
                }
                
                // éš±è—ç”¨æˆ¶è¨­ç½®ï¼Œé¡¯ç¤ºéŠæˆ²ç•Œé¢
                this.userSetup.classList.add('hidden');
                this.gameStatus.classList.remove('hidden');
                this.startBtn.classList.remove('hidden');
                this.startBtn.style.display = 'inline-block';
                this.progress.classList.remove('hidden');
                
                console.log('ç”¨æˆ¶ç¢ºèªå®Œæˆï¼Œé–‹å§‹æ¸¬è©¦æŒ‰éˆ•å·²é¡¯ç¤º');
            }
            
            async startGame() {
                this.startBtn.style.display = 'none';
                this.instructions.style.display = 'none';
                this.countdown.classList.remove('hidden');
                
                // å€’æ•¸3ç§’
                for (let i = 3; i > 0; i--) {
                    this.countdown.textContent = i;
                    await this.sleep(1000);
                }
                
                this.countdown.textContent = 'GO!';
                this.countdown.style.color = '#10b981';
                await this.sleep(500);
                
                this.countdown.classList.add('hidden');
                this.gameStarted = true;
                
                this.nextRound();
            }
            
            nextRound() {
                if (this.currentCount >= this.totalTests) {
                    this.endGame();
                    return;
                }
                
                // éš¨æ©Ÿé¸æ“‡ä¸€å€‹ç‡ˆæ³¡äº®èµ·
                const availableBulbs = [0, 1, 2, 3, 4, 5].filter(i => i !== this.currentLitBulb);
                this.currentLitBulb = availableBulbs[Math.floor(Math.random() * availableBulbs.length)];
                
                // ç«‹å³äº®ç‡ˆ
                this.lightBulb(this.currentLitBulb);
                this.startTime = Date.now();
                this.waitingForClick = true;
            }
            
            lightBulb(index) {
                this.bulbs.forEach((bulb, i) => {
                    if (i === index) {
                        bulb.classList.remove('bulb-off');
                        bulb.classList.add('bulb-on');
                    } else {
                        bulb.classList.remove('bulb-on');
                        bulb.classList.add('bulb-off');
                    }
                });
            }
            
            handleBulbClick(e) {
                if (!this.gameStarted || !this.waitingForClick) return;
                
                const clickedBulb = parseInt(e.target.dataset.bulb);
                
                if (clickedBulb === this.currentLitBulb) {
                    // æ­£ç¢ºé»æ“Šï¼Œè½‰æ›ç‚ºç§’ä¸¦æ¨å…¥è‡³3ä½å°æ•¸
                    const reactionTime = Math.round((Date.now() - this.startTime) / 10) / 100;
                    this.reactionTimes.push(reactionTime);
                    this.currentCount++;
                    
                    // æ›´æ–°é€²åº¦
                    this.currentCountEl.textContent = this.currentCount;
                    this.progressBar.style.width = `${(this.currentCount / this.totalTests) * 100}%`;
                    
                    // ç†„æ»…ç‡ˆæ³¡
                    e.target.classList.remove('bulb-on');
                    e.target.classList.add('bulb-off');
                    
                    this.waitingForClick = false;
                    
                    // ç«‹å³é€²è¡Œä¸‹ä¸€è¼ª
                    this.nextRound();
                }
            }
            
            endGame() {
                this.gameStarted = false;
                this.showTimesBtn.classList.remove('hidden');
                this.leaderboardBtn.classList.remove('hidden');
                this.resetBtn.classList.remove('hidden');
                
                // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
                this.calculateStats();
                
                // æ ¹æ“šç”¨æˆ¶é¡å‹é¡¯ç¤ºä¸åŒæŒ‰éˆ•
                if (this.userType === 'teacher') {
                    this.showMedianBtn.classList.remove('hidden');
                    this.showAverageBtn.classList.remove('hidden');
                    // è€å¸«ç›´æ¥å„²å­˜æ•¸æ“š
                    this.saveToDatabase();
                } else if (this.userType === 'student') {
                    // å­¸ç”Ÿé¡¯ç¤ºæ’åºæŒ‰éˆ•
                    this.sortTimesBtn.classList.remove('hidden');
                    // å­¸ç”Ÿéœ€è¦è‡ªè¡Œè¨ˆç®—
                    this.showStudentCalculation();
                } else if (this.userType === 'guest') {
                    // è¨ªå®¢ç›´æ¥é¡¯ç¤ºçµæœï¼Œä¸å„²å­˜æ•¸æ“š
                    this.showMedianBtn.classList.remove('hidden');
                    this.showAverageBtn.classList.remove('hidden');
                }
                
                // ç†„æ»…æ‰€æœ‰ç‡ˆæ³¡
                this.bulbs.forEach(bulb => {
                    bulb.classList.remove('bulb-on');
                    bulb.classList.add('bulb-off');
                });
            }
            
            calculateStats() {
                // è¨ˆç®—å¹³å‡æ•¸ï¼ˆä½¿ç”¨å·²æ¨å…¥çš„æ•¸æ“šï¼‰
                const sum = this.reactionTimes.reduce((a, b) => a + b, 0);
                this.calculatedAverage = Math.round((sum / this.reactionTimes.length) * 1000) / 1000;
                
                // è¨ˆç®—ä¸­ä½æ•¸ï¼ˆä½¿ç”¨å·²æ¨å…¥çš„æ•¸æ“šï¼‰
                const sortedTimes = [...this.reactionTimes].sort((a, b) => a - b);
                const n = sortedTimes.length;
                if (n % 2 === 0) {
                    this.calculatedMedian = Math.round(((sortedTimes[n/2 - 1] + sortedTimes[n/2]) / 2) * 1000) / 1000;
                } else {
                    this.calculatedMedian = sortedTimes[Math.floor(n/2)];
                }
            }
            
            showStudentCalculation() {
                this.results.classList.remove('hidden');
                this.reactionTimesDiv.classList.remove('hidden');
                this.studentCalculation.classList.remove('hidden');
                this.medianResultDiv.classList.add('hidden');
                this.averageResultDiv.classList.add('hidden');
                
                // é¡¯ç¤ºåæ‡‰æ™‚é–“
                const timesList = document.getElementById('timesList');
                timesList.innerHTML = '';
                this.reactionTimes.forEach((time, index) => {
                    const timeEl = document.createElement('div');
                    timeEl.className = 'bg-blue-500/30 rounded p-2';
                    timeEl.textContent = `${index + 1}: ${time.toFixed(2)}s`;
                    timesList.appendChild(timeEl);
                });
            }
            
            submitCalculation() {
                const userAverage = parseFloat(this.studentAverage.value);
                const userMedian = parseFloat(this.studentMedian.value);
                
                if (isNaN(userAverage) || isNaN(userMedian)) {
                    this.showCalculationFeedback('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å€¼ï¼', 'error');
                    return;
                }
                
                // æª¢æŸ¥è¨ˆç®—æ˜¯å¦æ­£ç¢ºï¼ˆå…è¨±å°èª¤å·®ï¼‰
                const averageCorrect = Math.abs(userAverage - this.calculatedAverage) < 0.005;
                const medianCorrect = Math.abs(userMedian - this.calculatedMedian) < 0.005;
                
                if (averageCorrect && medianCorrect) {
                    if (this.userType === 'student') {
                        this.showCalculationFeedback('ğŸ‰ è¨ˆç®—æ­£ç¢ºï¼æ‚¨çš„æˆç¸¾å·²å„²å­˜ã€‚', 'success');
                        this.saveToDatabase();
                    } else {
                        this.showCalculationFeedback('ğŸ‰ è¨ˆç®—æ­£ç¢ºï¼', 'success');
                    }
                    this.showMedianBtn.classList.remove('hidden');
                    this.showAverageBtn.classList.remove('hidden');
                } else {
                    let message = 'âŒ è¨ˆç®—éŒ¯èª¤ï¼Œè«‹é‡æ–°è¨ˆç®—ï¼š\n';
                    if (!averageCorrect) {
                        message += `â€¢ å¹³å‡æ•¸è¨ˆç®—éŒ¯èª¤\n`;
                    }
                    if (!medianCorrect) {
                        message += `â€¢ ä¸­ä½æ•¸è¨ˆç®—éŒ¯èª¤\n`;
                    }
                    this.showCalculationFeedback(message, 'error');
                }
            }
            
            showCalculationFeedback(message, type) {
                this.calculationFeedback.classList.remove('hidden');
                this.calculationFeedback.innerHTML = `
                    <div class="p-4 rounded-lg ${type === 'success' ? 'bg-green-500/20 text-green-300' : 'bg-red-500/20 text-red-300'}">
                        ${message.replace(/\n/g, '<br>')}
                    </div>
                `;
            }
            
            async saveToDatabase() {
                // è¨ªå®¢ä¸å„²å­˜æ•¸æ“š
                if (this.userType === 'guest') {
                    console.log('è¨ªå®¢æ¨¡å¼ï¼Œä¸å„²å­˜æ•¸æ“š');
                    return;
                }
                
                const data = {
                    ...this.userData,
                    reactionTimes: this.reactionTimes,
                    average: this.calculatedAverage,
                    median: this.calculatedMedian,
                    timestamp: Date.now(),
                    date: new Date().toISOString()
                };
                
                // å…ˆå„²å­˜åˆ°æœ¬åœ°å­˜å„²ï¼Œç¢ºä¿æ•¸æ“šä¸æœƒä¸Ÿå¤±
                try {
                    let scores = JSON.parse(localStorage.getItem('reactionScores') || '[]');
                    scores.push(data);
                    localStorage.setItem('reactionScores', JSON.stringify(scores));
                    console.log('æ•¸æ“šå·²å„²å­˜åˆ°æœ¬åœ°å­˜å„²');
                } catch (localError) {
                    console.error('æœ¬åœ°å­˜å„²å¤±æ•—:', localError);
                }
                
                // å˜—è©¦åŒæ­¥åˆ°Firebaseï¼ˆä¸é˜»å¡ä¸»æµç¨‹ï¼‰
                try {
                    if (window.firebaseDatabase && window.firebaseRef && window.firebasePush) {
                        const scoresRef = window.firebaseRef(window.firebaseDatabase, 'reactionScores');
                        
                        // ä½¿ç”¨è¼ƒçŸ­çš„è¶…æ™‚æ™‚é–“ï¼Œé¿å…é•·æ™‚é–“ç­‰å¾…
                        const firebasePromise = window.firebasePush(scoresRef, data);
                        const timeoutPromise = new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Firebaseæ“ä½œè¶…æ™‚')), 2000)
                        );
                        
                        await Promise.race([firebasePromise, timeoutPromise]);
                        console.log('æ•¸æ“šå·²åŒæ­¥åˆ° Firebase');
                    }
                } catch (firebaseError) {
                    console.warn('FirebaseåŒæ­¥å¤±æ•—ï¼ˆæ•¸æ“šå·²ä¿å­˜åœ¨æœ¬åœ°ï¼‰:', firebaseError.message || firebaseError);
                }
            }
            
            showReactionTimes() {
                this.results.classList.remove('hidden');
                this.reactionTimesDiv.classList.remove('hidden');
                this.medianResultDiv.classList.add('hidden');
                this.averageResultDiv.classList.add('hidden');
                
                // é¡¯ç¤ºå„æ¬¡æ™‚é–“
                const timesList = document.getElementById('timesList');
                timesList.innerHTML = '';
                this.reactionTimes.forEach((time, index) => {
                    const timeEl = document.createElement('div');
                    timeEl.className = 'bg-blue-500/30 rounded p-2';
                    timeEl.textContent = `${index + 1}: ${time.toFixed(2)}s`;
                    timesList.appendChild(timeEl);
                });
            }
            
            sortReactionTimes() {
                this.results.classList.remove('hidden');
                this.reactionTimesDiv.classList.remove('hidden');
                this.medianResultDiv.classList.add('hidden');
                this.averageResultDiv.classList.add('hidden');
                
                // æ’åºåæ‡‰æ™‚é–“ï¼ˆç”±å°è‡³å¤§ï¼‰
                const sortedTimes = [...this.reactionTimes].sort((a, b) => a - b);
                
                // é¡¯ç¤ºæ’åºå¾Œçš„æ™‚é–“
                const timesList = document.getElementById('timesList');
                timesList.innerHTML = '';
                
                // æ·»åŠ æç¤ºæ¨™é¡Œ
                const header = document.createElement('div');
                header.className = 'col-span-5 bg-green-500/30 rounded p-3 mb-2 text-center font-bold';
                header.textContent = 'ğŸ“Š åæ‡‰æ™‚é–“å·²ç”±å°è‡³å¤§æ’åˆ—';
                timesList.appendChild(header);
                
                sortedTimes.forEach((time, index) => {
                    const timeEl = document.createElement('div');
                    timeEl.className = 'bg-green-500/30 rounded p-2 border-2 border-green-400/50';
                    timeEl.textContent = `ç¬¬ ${index + 1} å: ${time.toFixed(2)}s`;
                    timesList.appendChild(timeEl);
                });
            }
            
            showMedian() {
                this.results.classList.remove('hidden');
                this.reactionTimesDiv.classList.add('hidden');
                this.medianResultDiv.classList.remove('hidden');
                this.averageResultDiv.classList.add('hidden');
                
                // è¨ˆç®—ä¸­ä½æ•¸
                const sortedTimes = [...this.reactionTimes].sort((a, b) => a - b);
                const n = sortedTimes.length;
                let median;
                let calculation;
                
                if (n % 2 === 0) {
                    // å¶æ•¸å€‹æ•¸æ“š
                    const mid1 = sortedTimes[n/2 - 1];
                    const mid2 = sortedTimes[n/2];
                    median = (mid1 + mid2) / 2;
                    calculation = `
                        <div class="mb-2">è³‡æ–™å€‹æ•¸: ${n} (å¶æ•¸)</div>
                        <div class="mb-2">æ’åºå¾Œçš„è³‡æ–™: ${sortedTimes.map(t => t.toFixed(3)).join(', ')}</div>
                        <div class="mb-2">ä¸­é–“å…©å€‹æ•¸å€¼: ${mid1.toFixed(3)}s å’Œ ${mid2.toFixed(3)}s</div>
                        <div class="text-yellow-400">ä¸­ä½æ•¸ = (${mid1.toFixed(3)} + ${mid2.toFixed(3)}) Ã· 2 = ${median.toFixed(3)}s</div>
                    `;
                } else {
                    // å¥‡æ•¸å€‹æ•¸æ“š
                    median = sortedTimes[Math.floor(n/2)];
                    calculation = `
                        <div class="mb-2">è³‡æ–™å€‹æ•¸: ${n} (å¥‡æ•¸)</div>
                        <div class="mb-2">æ’åºå¾Œçš„è³‡æ–™: ${sortedTimes.map(t => t.toFixed(3)).join(', ')}</div>
                        <div class="mb-2">ä¸­é–“ä½ç½®: ç¬¬ ${Math.floor(n/2) + 1} å€‹æ•¸å€¼</div>
                        <div class="text-yellow-400">ä¸­ä½æ•¸ = ${median.toFixed(3)}s</div>
                    `;
                }
                
                document.getElementById('medianCalculation').innerHTML = calculation;
                document.getElementById('medianValue').textContent = `ğŸ“Š åæ‡‰æ™‚é–“ä¸­ä½æ•¸: ${median.toFixed(3)} ç§’`;
            }
            
            showAverage() {
                this.results.classList.remove('hidden');
                this.reactionTimesDiv.classList.add('hidden');
                this.medianResultDiv.classList.add('hidden');
                this.averageResultDiv.classList.remove('hidden');
                
                // è¨ˆç®—å¹³å‡æ•¸
                const sum = this.reactionTimes.reduce((a, b) => a + b, 0);
                const average = sum / this.reactionTimes.length;
                
                // é¡¯ç¤ºè¨ˆç®—æ­¥é©Ÿ
                const timesStr = this.reactionTimes.map(t => t.toFixed(3)).join(' + ');
                const calculation = `
                    <div class="mb-2">å¹³å‡æ•¸ = ç¸½å’Œ Ã· æ¬¡æ•¸</div>
                    <div class="mb-2">ç¸½å’Œ = ${timesStr} = ${sum.toFixed(3)}s</div>
                    <div class="mb-2">æ¬¡æ•¸ = ${this.reactionTimes.length}</div>
                    <div class="text-yellow-400">å¹³å‡æ•¸ = ${sum.toFixed(3)} Ã· ${this.reactionTimes.length} = ${average.toFixed(3)}s</div>
                `;
                
                document.getElementById('averageCalculation').innerHTML = calculation;
                document.getElementById('averageValue').textContent = `ğŸ¯ åæ‡‰æ™‚é–“å¹³å‡æ•¸: ${average.toFixed(3)} ç§’`;
            }
            
            showLeaderboard() {
                this.leaderboard.classList.remove('hidden');
                this.loadLeaderboard('all');
            }
            
            hideLeaderboard() {
                this.leaderboard.classList.add('hidden');
            }
            
            async loadLeaderboard(filter = 'all') {
                // é¡¯ç¤ºè¼‰å…¥ä¸­
                this.leaderboardList.innerHTML = '<div class="text-center text-yellow-400">è¼‰å…¥ä¸­...</div>';
                
                let scores = [];
                
                // å…ˆè¼‰å…¥æœ¬åœ°æ•¸æ“šï¼Œç¢ºä¿æœ‰åŸºæœ¬é¡¯ç¤º
                try {
                    scores = JSON.parse(localStorage.getItem('reactionScores') || '[]')
                        .filter(score => score && score.average && (filter === 'all' || score.type === filter))
                        .sort((a, b) => a.average - b.average)
                        .slice(0, 20);
                    console.log('å¾æœ¬åœ°å­˜å„²è¼‰å…¥æ’è¡Œæ¦œæ•¸æ“š');
                } catch (localError) {
                    console.error('æœ¬åœ°æ•¸æ“šè¼‰å…¥å¤±æ•—:', localError);
                    scores = [];
                }
                
                // å˜—è©¦å¾Firebaseè¼‰å…¥æ›´æ–°æ•¸æ“šï¼ˆä¸é˜»å¡é¡¯ç¤ºï¼‰
                try {
                    if (window.firebaseDatabase && window.firebaseRef && window.firebaseOnValue) {
                        const scoresRef = window.firebaseRef(window.firebaseDatabase, 'reactionScores');
                        
                        // è¨­ç½®è¼ƒçŸ­çš„è¶…æ™‚æ™‚é–“
                        const firebasePromise = new Promise((resolve, reject) => {
                            let unsubscribed = false;
                            const unsubscribe = window.firebaseOnValue(scoresRef, (snapshot) => {
                                if (unsubscribed) return;
                                unsubscribed = true;
                                try {
                                    const data = snapshot.val();
                                    if (data) {
                                        const scoresArray = Object.values(data)
                                            .filter(score => score && score.average && (filter === 'all' || score.type === filter))
                                            .sort((a, b) => a.average - b.average)
                                            .slice(0, 20);
                                        resolve(scoresArray);
                                    } else {
                                        resolve([]);
                                    }
                                } catch (err) {
                                    reject(err);
                                }
                            }, (error) => {
                                if (!unsubscribed) {
                                    unsubscribed = true;
                                    reject(error);
                                }
                            });
                            
                            // è¶…æ™‚è™•ç†
                            setTimeout(() => {
                                if (!unsubscribed) {
                                    unsubscribed = true;
                                    if (unsubscribe) unsubscribe();
                                    reject(new Error('Firebaseè¼‰å…¥è¶…æ™‚'));
                                }
                            }, 2000);
                        });
                        
                        const firebaseScores = await firebasePromise;
                        scores = firebaseScores;
                        console.log('å¾Firebaseæ›´æ–°æ’è¡Œæ¦œæ•¸æ“š');
                    }
                } catch (firebaseError) {
                    console.warn('Firebaseè¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°æ•¸æ“š:', firebaseError.message || firebaseError);
                }
                
                // é¡¯ç¤ºæ’è¡Œæ¦œ
                if (scores.length === 0) {
                    this.leaderboardList.innerHTML = '<div class="text-center text-gray-400">æš«ç„¡æ•¸æ“š</div>';
                } else {
                    this.displayLeaderboard(scores);
                }
            }
            
            displayLeaderboard(scores) {
                if (scores.length === 0) {
                    this.leaderboardList.innerHTML = '<div class="text-center text-gray-400">æš«ç„¡æ•¸æ“š</div>';
                    return;
                }
                
                // å»é™¤é‡è¤‡ç”¨æˆ¶ï¼Œåªä¿ç•™æœ€ä½³æˆç¸¾
                const uniqueScores = this.getUniqueUsersBestScores(scores);
                
                // å‰µå»ºæ¨™é¡Œåˆ—
                const headerRow = `
                    <div class="flex items-center justify-between p-3 bg-yellow-500/20 rounded-lg border-2 border-yellow-400/50 mb-3">
                        <div class="flex items-center space-x-3">
                            <span class="text-lg font-bold w-12 text-yellow-300 whitespace-nowrap">æ’å</span>
                            <span class="text-lg font-bold text-yellow-300 whitespace-nowrap">æŒ‘æˆ°è€…</span>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-yellow-300 whitespace-nowrap">æœ€ä½³å¹³å‡åæ‡‰æ™‚é–“</div>
                        </div>
                    </div>
                `;
                
                // å‰µå»ºæ•¸æ“šåˆ—
                const dataRows = uniqueScores.map((score, index) => {
                    const rank = index + 1;
                    const medal = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : `${rank}.`;
                    const userIcon = score.type === 'teacher' ? 'ğŸ‘¨â€ğŸ«' : 'ğŸ‘¨â€ğŸ“';
                    const userInfo = score.type === 'teacher' 
                        ? `${score.name}è€å¸«` 
                        : `${score.class} ${score.number}è™Ÿ`;
                    
                    return `
                        <div class="flex items-center justify-between p-3 bg-white/10 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <span class="text-lg font-bold w-8">${medal}</span>
                                <span class="text-lg">${userIcon}</span>
                                <span class="font-medium">${userInfo}</span>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold text-green-400">${score.average.toFixed(3)}s</div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                this.leaderboardList.innerHTML = headerRow + dataRows;
            }
            
            getUniqueUsersBestScores(scores) {
                const userMap = new Map();
                
                // éæ­·æ‰€æœ‰æˆç¸¾ï¼Œç‚ºæ¯å€‹ç”¨æˆ¶ä¿ç•™æœ€ä½³æˆç¸¾
                scores.forEach(score => {
                    let userKey;
                    if (score.type === 'teacher') {
                        userKey = `teacher_${score.name}`;
                    } else {
                        userKey = `student_${score.class}_${score.number}`;
                    }
                    
                    // å¦‚æœç”¨æˆ¶ä¸å­˜åœ¨æˆ–ç•¶å‰æˆç¸¾æ›´å¥½ï¼Œå‰‡æ›´æ–°è¨˜éŒ„
                    if (!userMap.has(userKey) || score.average < userMap.get(userKey).average) {
                        userMap.set(userKey, score);
                    }
                });
                
                // è½‰æ›ç‚ºé™£åˆ—ä¸¦æŒ‰å¹³å‡æ™‚é–“æ’åº
                return Array.from(userMap.values()).sort((a, b) => a.average - b.average);
            }
            
            resetGame() {
                // å®Œå…¨é‡ç½®æ‰€æœ‰éŠæˆ²ç‹€æ…‹
                this.reactionTimes = [];
                this.currentCount = 0;
                this.gameStarted = false;
                this.waitingForClick = false;
                this.currentLitBulb = -1;
                this.calculatedAverage = 0;
                this.calculatedMedian = 0;
                this.userType = null;
                this.userData = {};
                
                // éš±è—æ‰€æœ‰éŠæˆ²ç›¸é—œå…ƒç´ 
                this.gameStatus.classList.add('hidden');
                this.startBtn.classList.add('hidden');
                this.showTimesBtn.classList.add('hidden');
                this.sortTimesBtn.classList.add('hidden');
                this.showMedianBtn.classList.add('hidden');
                this.showAverageBtn.classList.add('hidden');
                this.leaderboardBtn.classList.add('hidden');
                this.resetBtn.classList.add('hidden');
                this.countdown.classList.add('hidden');
                this.progress.classList.add('hidden');
                this.results.classList.add('hidden');
                this.studentCalculation.classList.add('hidden');
                this.calculationFeedback.classList.add('hidden');
                this.leaderboard.classList.add('hidden');
                
                // é¡¯ç¤ºç”¨æˆ¶è¨­ç½®ç•Œé¢
                this.userSetup.classList.remove('hidden');
                
                // é‡ç½®æ‰€æœ‰è¡¨å–®
                document.querySelectorAll('input[name="userType"]').forEach(radio => {
                    radio.checked = false;
                });
                this.teacherForm.classList.add('hidden');
                this.studentForm.classList.add('hidden');
                
                // æ¸…ç©ºæ‰€æœ‰è¼¸å…¥æ¡†
                this.teacherName.value = '';
                this.teacherPassword.value = '';
                this.studentClass.value = '';
                this.studentNumber.value = '';
                this.studentAverage.value = '';
                this.studentMedian.value = '';
                
                // é‡ç½®é€²åº¦é¡¯ç¤º
                this.currentCountEl.textContent = '0';
                this.progressBar.style.width = '0%';
                this.countdown.style.color = '#fbbf24';
                this.instructions.style.display = 'block';
                
                // ç†„æ»…æ‰€æœ‰ç‡ˆæ³¡
                this.bulbs.forEach(bulb => {
                    bulb.classList.remove('bulb-on');
                    bulb.classList.add('bulb-off');
                });
                
                console.log('éŠæˆ²å·²é‡ç½®ï¼Œå›åˆ°èº«ä»½é¸æ“‡ç•«é¢');
            }
            
            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        // åˆå§‹åŒ–éŠæˆ²
        document.addEventListener('DOMContentLoaded', () => {
            new ReactionTest();
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c571df3609c77c5',t:'MTc2OTY3Mjc5OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>